<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>notepad</title>
  <style>
    body {
      font-family: monospace;
      background-color: #121212;
      color: #eeeeee;
      display: flex;
      flex-direction: column;
      align-items: center;
      margin: 0;
      padding: 1rem 0;
    }

    #toolbar {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      background: #181818;
      border-radius: 12px;
      padding: 10px 12px 6px 12px;
      max-width: 768px;
      width: 100%;
      margin-bottom: 0.5rem;
      justify-content: center;
      align-items: center;
      box-sizing: border-box;
      position: sticky;
      top: 1rem;
      z-index: 100;
      border: 1px solid #333;
    }

    #toolbar button {
      background: #232323;
      color: #eee;
      border: 1px solid #333;
      border-radius: 8px;
      padding: 6px 16px;
      font-size: 1rem;
      cursor: pointer;
      transition: background 0.2s, box-shadow 0.2s;
      min-width: 38px;
      min-height: 38px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-sizing: border-box;
    }

    #toolbar button:hover {
      background: #333;
      box-shadow: 0 2px 8px 0 #0002;
    }

    #notepad {
      max-width: 768px;
      width: 100%;
      min-height: 70vh;
      padding: 20px;
      background-color: #222;
      border: 1px solid #444;
      color: #eee;
      font-size: 1rem;
      line-height: 1.5;
      border-radius: 14px;
      box-sizing: border-box;
      outline: none;
    }

    #notepad a {
      color: #7ecbff;
      text-decoration: underline;
      transition: color 0.2s;
    }

    #notepad a:hover {
      color: #b3e0ff;
    }

    #notepad pre {
      background: #111;
      border: 1px solid #333;
      padding: 1em;
      border-radius: 8px;
      white-space: pre-wrap;
      font-family: 'Courier New', Courier, monospace;
    }

    h1 {
      margin-top: 0;
    }

    #opened-filename {
      width: 100%;
      max-width: 768px;
      margin: 0 auto 6px auto;
      text-align: center;
      color: #7ecbff;
      font-size: 0.95rem;
      display: none;
    }
  </style>
</head>

<body>
  <div id="opened-filename"></div>
  <div id="toolbar">
    <button type="button" id="open-btn" title="Open file">üìÇ</button>
    <button type="button" id="save-btn" title="Save file (Ctrl+S)">üíæ</button>
    <button type="button" id="clear-btn" title="Clear notes">üóëÔ∏è</button>
    <button type="button" class="format-btn" data-command="bold" title="Bold (Ctrl+B)"><b>B</b></button>
    <button type="button" class="format-btn" data-command="italic" title="Italic (Ctrl+I)"><i>I</i></button>
    <button type="button" class="format-btn" data-command="underline" title="Underline (Ctrl+U)"><u>U</u></button>
    <button type="button" class="format-btn" data-command="strikeThrough"
      title="Strikethrough (Ctrl+D)"><s>S</s></button>
    <button type="button" class="format-block-btn" data-tag="h2" title="Heading">H2</button>
    <button type="button" class="format-block-btn" data-tag="pre" title="Code Block">&lt;/&gt;</button>
    <button type="button" class="format-btn" data-command="insertUnorderedList" title="Bulleted List">‚Ä¢ List</button>
    <button type="button" class="format-btn" data-command="insertOrderedList" title="Numbered List">1. List</button>
    <button type="button" class="format-btn" data-command="justifyLeft" title="Justify Left">L</button>
    <button type="button" class="format-btn" data-command="justifyCenter" title="Justify Center">C</button>
    <button type="button" class="format-btn" data-command="justifyRight" title="Justify Right">R</button>
    <button type="button" id="link-btn" title="Link">üîó</button>
    <button type="button" id="image-btn" title="Image">üñºÔ∏è</button>
    <input type="file" id="image-upload" accept="image/*" style="display:none">
    <button type="button" class="format-btn" data-command="undo" title="Undo (Ctrl+Z)">‚Ü∫</button>
    <button type="button" class="format-btn" data-command="redo" title="Redo (Ctrl+Y)">‚Üª</button>
    <button type="button" id="clear-format-btn" title="Clear Formatting">üßπ</button>
  </div>
  <div id="notepad" contenteditable="true" role="main"></div>
  <script>
    (function () {
      const NotepadApp = {
        notepad: null,
        imageUpload: null,
        openedFilename: null,
        currentFilename: '',
        MAX_IMAGE_WIDTH: 1920,
        IMAGE_QUALITY: 0.9,
        init() {
          this.cacheDOMElements();
          this.loadFromLocalStorage();
          this.bindEvents();
        },
        cacheDOMElements() {
          this.notepad = document.getElementById('notepad');
          this.imageUpload = document.getElementById('image-upload');
          this.openedFilename = document.getElementById('opened-filename');
        },
        bindEvents() {
          document.getElementById('open-btn').addEventListener('click', () => this.openFile());
          document.getElementById('save-btn').addEventListener('click', () => this.saveFile());
          document.getElementById('clear-btn').addEventListener('click', () => this.clearNotes());
          document.getElementById('link-btn').addEventListener('click', () => this.insertLink());
          document.getElementById('image-btn').addEventListener('click', () => this.imageUpload.click());
          document.getElementById('clear-format-btn').addEventListener('click', () => this.clearFormatting());
          document.querySelectorAll('.format-btn').forEach(btn => {
            btn.addEventListener('click', () => this.format(btn.dataset.command));
          });
          document.querySelectorAll('.format-block-btn').forEach(btn => {
            btn.addEventListener('click', () => this.formatBlock(btn.dataset.tag));
          });
          this.imageUpload.addEventListener('change', (e) => this.handleImageUpload(e));
          this.notepad.addEventListener('input', () => this.saveToLocalStorage());
          this.notepad.addEventListener('keydown', (e) => this.handleKeyDown(e));
          this.notepad.addEventListener('paste', (e) => this.handlePaste(e));
        },
        handleKeyDown(e) {
          if (e.ctrlKey && !e.shiftKey) {
            let command;
            switch (e.key.toLowerCase()) {
              case 'b': command = 'bold'; break;
              case 'i': command = 'italic'; break;
              case 'u': command = 'underline'; break;
              case 'd': command = 'strikeThrough'; break;
              case 's': e.preventDefault(); this.saveFile(); break;
            }
            if (command) {
              e.preventDefault();
              this.format(command);
            }
          }
        },
        handleImageUpload(e) {
          const file = e.target.files[0];
          if (file) {
            this.processImageFile(file);
          }
          e.target.value = '';
        },
        handlePaste(e) {
          const items = (e.clipboardData || window.clipboardData).items;
          for (const item of items) {
            if (item.type.startsWith('image/')) {
              e.preventDefault();
              const blob = item.getAsFile();
              this.processImageFile(blob);
            }
          }
        },
        format(command, value = null) {
          document.execCommand(command, false, value);
          this.notepad.focus();
        },
        formatBlock(tag) {
          const selection = window.getSelection();
          if (selection.rangeCount === 0) return;
          let container = selection.getRangeAt(0).commonAncestorContainer;
          container = container.nodeType === 3 ? container.parentNode : container;
          const newTag = container.closest(tag) ? 'div' : tag;
          this.format('formatBlock', newTag);
        },
        clearFormatting() {
          this.format('removeFormat');
        },
        insertLink() {
          const url = prompt('Enter URL:', 'https://');
          if (url) {
            this.format('createLink', url);
          }
        },
        clearNotes() {
          if (confirm("Are you sure you want to clear the entire note?")) {
            this.notepad.innerHTML = '';
            this.currentFilename = '';
            this.openedFilename.textContent = '';
            this.openedFilename.style.display = 'none';
            this.saveToLocalStorage();
          }
        },
        saveFile() {
          const defaultName = this.currentFilename || 'my-notes.html';
          const fileName = prompt("Enter a filename for your note:", defaultName);
          if (!fileName) return;
          const content = this.notepad.innerHTML;
          const finalHtml = this.createHtmlTemplate(content);
          const blob = new Blob([finalHtml], { type: 'text/html' });
          const link = document.createElement('a');
          link.href = URL.createObjectURL(blob);
          link.download = fileName.endsWith('.html') ? fileName : `${fileName}.html`;
          link.click();
          URL.revokeObjectURL(link.href);
        },
        openFile() {
          const fileInput = document.createElement('input');
          fileInput.type = 'file';
          fileInput.accept = '.html';
          fileInput.onchange = (e) => {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (event) => {
              const content = event.target.result;
              const doc = new DOMParser().parseFromString(content, 'text/html');
              const generatorMeta = doc.querySelector('meta[name="generator"][content="WebNotepad"]');
              const loadedNotepad = doc.getElementById('notepad');
              if (generatorMeta && loadedNotepad) {
                this.notepad.innerHTML = loadedNotepad.innerHTML;
                this.currentFilename = file.name;
                this.openedFilename.textContent = `Opened: ${file.name}`;
                this.openedFilename.style.display = 'block';
                this.saveToLocalStorage();
              } else {
                alert("File cannot be opened. It was not created with this notepad.");
              }
            };
            reader.readAsText(file);
          };
          fileInput.click();
        },
        saveToLocalStorage() {
          localStorage.setItem('webNotebookContent', this.notepad.innerHTML);
        },
        loadFromLocalStorage() {
          const savedContent = localStorage.getItem('webNotebookContent');
          if (savedContent) {
            this.notepad.innerHTML = savedContent;
          }
        },
        processImageFile(file) {
          const reader = new FileReader();
          reader.onload = (event) => {
            const tempImg = new Image();
            tempImg.onload = () => {
              const canvas = document.createElement('canvas');
              const ctx = canvas.getContext('2d');
              const scaleFactor = tempImg.width > this.MAX_IMAGE_WIDTH ? this.MAX_IMAGE_WIDTH / tempImg.width : 1;
              canvas.width = tempImg.width * scaleFactor;
              canvas.height = tempImg.height * scaleFactor;
              ctx.drawImage(tempImg, 0, 0, canvas.width, canvas.height);
              const dataUrl = canvas.toDataURL('image/jpeg', this.IMAGE_QUALITY);
              this.format('insertHTML', `<img src="${dataUrl}" alt="User-uploaded image">`);
            };
            tempImg.src = event.target.result;
          };
          reader.readAsDataURL(file);
        },
        createHtmlTemplate(content) {
          return `
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="generator" content="WebNotepad">
<title>My Note</title>
<style>
body { font-family: monospace; background-color: #121212; color: #eeeeee; display: flex; flex-direction: column; align-items: center; min-height: 100vh; margin: 0; }
#notepad { max-width: 768px; width: 100%; padding: 20px; background-color: #222; border: 1px solid #444; color: #eee; font-size: 1rem; line-height: 1.5; border-radius: 14px; box-sizing: border-box; margin: 20px auto; }
#notepad img { max-width: 100%; height: auto; display: block; margin: 8px 0; cursor: pointer; border-radius: 4px; }
#notepad a { color: #7ecbff; }
#notepad pre { background: #111; border: 1px solid #333; padding: 1em; border-radius: 8px; white-space: pre-wrap; }
</style>
</head>
<body>
<div id="notepad">${content}</div>
<script>
document.getElementById('notepad').addEventListener('click', function(e) {
if (e.target.tagName === 'IMG' && e.target.src.startsWith('data:image')) {
const newWindow = window.open();
newWindow.document.write(\`
<!DOCTYPE html>
<head><title>Full Size Image</title><style>body{margin:0; background-color:#121212; display:flex; justify-content:center; align-items:center; height:100vh;} img{max-width:100%; max-height:100vh; object-fit:contain;}</style></head>
<body><img src="\${e.target.src}" alt="Full size image"></body>
\`);
}
});
<\/script>
</body>
</html>`;
        }
      };
      document.addEventListener('DOMContentLoaded', () => NotepadApp.init());
    })();
  </script>
</body>

</html>