<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Edit by Johnny Heggelund</title>
<style>
:root {
--b: #000;
--t: #39FF14;
--f: 'Courier New', monospace
}
html,
body {
margin: 0;
padding: 0;
width: 100%;
height: 100%;
background: var(--b);
overflow: hidden
}
#e {
width: 100%;
height: 100%;
box-sizing: border-box;
background: 0;
color: var(--t);
border: 0;
outline: 0;
resize: none;
font: 16px var(--f);
padding: 15px;
white-space: pre;
overflow-wrap: normal;
overflow: auto;
caret-color: #00BFFF
}
</style>
</head>
<body>
<textarea id="e" spellcheck="false"></textarea>
<script>
const E = {
h: null, n: 'Untitled', d: false, v: 1, e: null,
init() {
this.e = document.getElementById('e');
this.e.oninput = () => { if (!this.d) this.dirty(true); };
this.e.onkeydown = this.tab.bind(this);
document.onkeydown = this.key.bind(this);
window.onbeforeunload = this.unload.bind(this);
this.dirty(false);
this.e.focus();
},
dirty(isDirty) {
this.d = isDirty;
document.title = `${isDirty ? '*' : ''}${this.n}`;
},
async open() {
if (this.d && !confirm("Unsaved changes. Continue?")) return;
try {
[this.h] = await showOpenFilePicker();
const file = await this.h.getFile();
this.e.value = await file.text();
this.n = file.name;
this.v = 1;
this.dirty(false);
} catch (err) { }
this.e.focus();
},
save() {
const name = this.n === 'Untitled' ? 'Untitled.txt' : this.n;
const i = name.lastIndexOf('.');
const base = i < 0 ? name : name.slice(0, i);
const ext = i < 0 ? '' : name.slice(i);
const dlName = `${base}-v${String(this.v++).padStart(3, '0')}${ext}`;
const a = document.createElement('a');
a.href = URL.createObjectURL(new Blob([this.e.value]));
a.download = dlName;
a.click();
URL.revokeObjectURL(a.href);
this.dirty(false);
},
key(e) {
if (!e.metaKey && !e.ctrlKey) return;
const k = e.key.toLowerCase();
if (k === 'o' || k === 's') e.preventDefault();
if (k === 'o') this.open();
if (k === 's') this.save();
},
unload(e) {
if (this.d) { e.preventDefault(); e.returnValue = ''; }
},
tab(e) {
if (e.key !== 'Tab') return;
e.preventDefault();
const { value: v, selectionStart: ss, selectionEnd: se } = this.e;
const tab = '  ';
const start = v.lastIndexOf('\n', ss - 1) + 1;
const endIdx = v.indexOf('\n', se - 1);
const end = endIdx === -1 ? v.length : endIdx;
const oldLines = v.substring(start, end);
const lines = oldLines.split('\n');
let changed = 0;
const newLines = lines.map(line => {
if (e.shiftKey) {
if (line.startsWith(tab)) {
changed -= tab.length;
return line.substring(tab.length);
}
} else if (line || lines.length === 1) {
changed += tab.length;
return tab + line;
}
return line;
}).join('\n');
if (oldLines === newLines) return;
this.e.value = v.substring(0, start) + newLines + v.substring(end);
this.e.selectionStart = ss + (newLines.split('\n')[0].length - lines[0].length);
this.e.selectionEnd = se + changed;
if (!this.d) this.dirty(true);
}
};
window.onload = () => E.init();
</script>
</body>
</html>